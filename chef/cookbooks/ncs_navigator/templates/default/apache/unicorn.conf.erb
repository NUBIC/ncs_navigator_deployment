<VirtualHost *:443>
  SSLEngine on
  SSLCertificateFile <%= @ssl_certificate %>
  SSLCertificateKeyFile <%= @ssl_key %>

  <% if @ssl_certificate_chain %>
  SSLCertificateChainFile <%= @ssl_certificate_chain %>
  <% end %>

  ServerName <%= @host %>

  ErrorDocument 503 /maintenance.html

  RewriteEngine on

  # If tmp/stop.txt exists ...
  RewriteCond %{DOCUMENT_ROOT}/../tmp/stop.txt -f
  # ... and the request is not for an existing static file ...
  RewriteCond %{DOCUMENT_ROOT}/%{REQUEST_FILENAME} !-f
  # ... send a 503 status for the requested page.
  RewriteRule ^(.*)$ /$1 [R=503,L]

  ProxyPass / <%= @internal_uri %>
</VirtualHost>
